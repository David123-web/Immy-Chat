FROM node:16-bullseye-slim

WORKDIR /app

COPY package.json yarn.lock ./
RUN yarn install
COPY . .

# Set environment variables
ARG NEXT_PUBLIC_BASE_API_URL
ARG NEXT_PUBLIC_REACT_APP_FACEBOOK_APP_ID
ARG NEXT_PUBLIC_REACT_APP_GOOGLE_APP_ID
ARG NEXT_PUBLIC_EXTERNAL_API_URL
ARG NEXT_PUBLIC_EXTERNAL_API_URL2
ARG NEXT_PUBLIC_FIREBASE_FCM_VAPID_KEY
ARG PORT=9090

ENV NEXT_PUBLIC_BASE_API_URL=$NEXT_PUBLIC_BASE_API_URL
ENV NEXT_PUBLIC_REACT_APP_FACEBOOK_APP_ID=$NEXT_PUBLIC_REACT_APP_FACEBOOK_APP_ID
ENV NEXT_PUBLIC_REACT_APP_GOOGLE_APP_ID=$NEXT_PUBLIC_REACT_APP_GOOGLE_APP_ID
ENV NEXT_PUBLIC_EXTERNAL_API_URL=$NEXT_PUBLIC_EXTERNAL_API_URL
ENV NEXT_PUBLIC_EXTERNAL_API_URL2=$NEXT_PUBLIC_EXTERNAL_API_URL2
ENV NEXT_PUBLIC_FIREBASE_FCM_VAPID_KEY=$NEXT_PUBLIC_FIREBASE_FCM_VAPID_KEY
ENV PORT=$PORT

RUN yarn build

EXPOSE 9090

CMD [ "yarn", "start:prod" ]